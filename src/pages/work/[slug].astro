---
import { getCollection, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

const bookCoverGlobs = import.meta.glob<{ default: ImageMetadata }>(
  "../../assets/images/books/*",
  { eager: true },
);
const bookCovers = Object.values(bookCoverGlobs).map((mod) => mod.default);

export async function getStaticPaths() {
  const workEntries = await getCollection("work");
  return workEntries.map((entry) => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
const isEditing = entry.id === "editing";
---

<BaseLayout title={entry.data.title} description={entry.data.description}>
  <h1 class="font-serif font-black text-4xl md:text-5xl lg:text-6xl mb-8">
    {entry.data.title}
  </h1>
  <div class="prose prose-lg max-w-none">
    <Content />
  </div>
  {
    isEditing && (
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
        {bookCovers.map((book, i) => (
          <img
            src={book.src}
            alt={`Book cover ${i + 1}`}
            class="w-full rounded shadow-sm"
            loading="lazy"
          />
        ))}
      </div>
    )
  }
</BaseLayout>
