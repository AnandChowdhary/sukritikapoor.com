---
import { Image } from "astro:assets";
import { getCollection, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const workEntries = await getCollection("work");
  return workEntries.map((entry) => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
const isEditing = entry.id === "editing";

const bookCoverAltText: Record<string, string> = {
  book1: "The Civil War Visual Encyclopedia by DK Smithsonian",
  book2: "Super Simple Physics by DK",
  book3: "Eyewitness Forensic Science by DK",
  book4: "Picturepedia by DK Smithsonian",
  book5: "Mega Bites Dinosaurs by DK",
  book6: "1000 Inventions and Discoveries by DK",
  book7: "Super Simple Biology by DK",
};

const bookCovers = isEditing
  ? Object.entries(
      import.meta.glob<{ default: ImageMetadata }>(
        "../../assets/images/books/*",
        { eager: true },
      ),
    ).map(([path, mod]) => {
      const filename =
        path
          .split("/")
          .pop()
          ?.replace(/\.\w+$/, "") ?? "";
      return {
        src: mod.default,
        alt: bookCoverAltText[filename] ?? `Book cover: ${filename}`,
      };
    })
  : [];
---

<BaseLayout title={entry.data.title} description={entry.data.description}>
  <h1 class="font-serif font-black text-4xl md:text-5xl lg:text-6xl mb-8">
    {entry.data.title}
  </h1>
  <div class="prose prose-lg max-w-none">
    <Content />
  </div>
  {
    isEditing && (
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
        {bookCovers.map((cover) => (
          <Image
            src={cover.src}
            alt={cover.alt}
            class="w-full rounded shadow-sm"
            loading="lazy"
            width={300}
            height={400}
          />
        ))}
      </div>
    )
  }
</BaseLayout>
