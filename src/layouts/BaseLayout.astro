---
import "../styles/global.css";
import NavLink from "../components/NavLink.astro";
import LinkedInIcon from "../components/LinkedInIcon.astro";
import { buildDefaultJsonLd } from "../utils/json-ld";

interface Props {
  title?: string;
  description?: string;
  jsonLd?: Record<string, unknown>;
}

const { title, description, jsonLd } = Astro.props;
const pageTitle = title ? `${title} – Sukriti Kapoor` : "Sukriti Kapoor";
const metaDescription =
  description ??
  "Sukriti Kapoor is a writer and editor. Explore her work, poetry, and prose.";

const canonicalUrl = new URL(Astro.url.pathname, Astro.site).href;
const structuredData = jsonLd ?? buildDefaultJsonLd(Astro.site?.href ?? "");

const base = import.meta.env.BASE_URL;
const navLinks = [
  { href: `${base}work`, label: "Work" },
  { href: `${base}poetry`, label: "Poetry" },
  { href: `${base}prose`, label: "Prose" },
];

const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={metaDescription} />
    <meta name="generator" content={Astro.generator} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={metaDescription} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalUrl} />
    <meta
      property="og:image"
      content={new URL(`${base}og-image.png`, Astro.site).href}
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <link rel="canonical" href={canonicalUrl} />
    <title>{pageTitle}</title>
    <script
      is:inline
      type="application/ld+json"
      set:html={JSON.stringify(structuredData)}
    />
    <link rel="icon" type="image/svg+xml" href={`${base}favicon.svg`} />
    <link rel="icon" type="image/x-icon" href={`${base}favicon.ico`} />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Poetry — Sukriti Kapoor"
      href={`${base}poetry/rss.xml`}
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Prose — Sukriti Kapoor"
      href={`${base}prose/rss.xml`}
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@700;900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="min-h-screen flex flex-col font-sans text-black bg-white">
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:bg-white focus:px-4 focus:py-2 focus:z-50 focus:rounded focus:shadow"
    >
      Skip to main content
    </a>

    <header
      class="lg:hidden flex items-center justify-between px-6 py-4 border-b border-gray-100"
    >
      <a href={base} class="font-serif font-bold text-2xl">Sukriti Kapoor</a>
      <button
        id="mobile-menu-toggle"
        class="p-2"
        aria-label="Toggle menu"
        aria-expanded="false"
        aria-controls="mobile-nav"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </header>

    <nav
      id="mobile-nav"
      class="hidden lg:hidden px-6 py-4 border-b border-gray-100"
      aria-label="Mobile navigation"
    >
      {
        navLinks.map((link) => (
          <NavLink {...link} currentPath={currentPath} mobile />
        ))
      }
      <div class="pt-2">
        <LinkedInIcon />
      </div>
    </nav>

    <div class="flex flex-1">
      <aside
        class="hidden lg:flex flex-col w-sidebar min-w-[200px] px-8 py-8 min-h-screen fixed left-0 top-0"
        aria-label="Sidebar"
      >
        <a href={base} class="font-serif font-bold text-3xl block"
          >Sukriti Kapoor</a
        >
        <nav
          class="flex flex-col gap-1 mt-auto mb-auto"
          aria-label="Main navigation"
        >
          {
            navLinks.map((link) => (
              <NavLink {...link} currentPath={currentPath} />
            ))
          }
        </nav>
        <LinkedInIcon />
      </aside>

      <main
        id="main-content"
        class="flex-1 px-6 lg:pl-sidebar lg:px-16 py-8 lg:py-8"
      >
        <slot />
      </main>
    </div>

    <footer class="px-8 py-6 lg:pl-sidebar">
      <div class="flex items-center justify-center gap-2 text-sm">
        <span>&copy; 2023 Sukriti Kapoor</span>
      </div>
    </footer>

    <script>
      const toggle = document.getElementById("mobile-menu-toggle");
      const nav = document.getElementById("mobile-nav");
      toggle?.addEventListener("click", () => {
        nav?.classList.toggle("hidden");
        const expanded = toggle.getAttribute("aria-expanded") === "true";
        toggle.setAttribute("aria-expanded", String(!expanded));
      });
    </script>
  </body>
</html>
